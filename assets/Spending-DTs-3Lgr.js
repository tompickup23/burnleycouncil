import{j as e}from"./tanstack-BHj98Y4o.js";import{r as d,i as fe}from"./vendor-BUcjPAt-.js";import{c as H,u as ve,a as ge,t as E,L as ye,D as be,S as Ne,X as ie,d as x,B as Ce,T as Se,f as _e}from"./index-pGaQqd3_.js";import{C as re,a as ke}from"./chevron-up-Co210WKe.js";import{F as we}from"./funnel-BZnTtdAI.js";import{C as De}from"./chart-column-S2Au_v7m.js";import{R as I,A as Le,C as Z,X as ee,Y as ae,T as V,d as ce,B as oe,a as de,c as se,P as Te,b as Me}from"./recharts-DyzHFDWD.js";const $e=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Ae=H("activity",$e);const Fe=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],Ee=H("arrow-down-right",Fe);const Oe=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],Re=H("arrow-up-right",Oe);const ze=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Pe=H("download",ze);function A({label:N,value:g,options:R,onChange:z,placeholder:B}){const[u,j]=d.useState(!1),[k,L]=d.useState(""),T=d.useRef(null),P=d.useRef(null),w=R.filter(o=>o.toLowerCase().includes(k.toLowerCase())),C=g||B;d.useEffect(()=>{if(!u)return;const o=l=>{T.current&&!T.current.contains(l.target)&&(j(!1),L(""))};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[u]),d.useEffect(()=>{u&&P.current&&P.current.focus()},[u]);const M=o=>{o.key==="Escape"?(j(!1),L("")):o.key==="Enter"&&!u&&j(!0)};return e.jsxs("div",{className:"searchable-select",ref:T,onKeyDown:M,children:[N&&e.jsx("label",{children:N}),e.jsxs("div",{className:"select-container",children:[e.jsxs("button",{type:"button",className:"select-trigger",onClick:()=>j(!u),"aria-haspopup":"listbox","aria-expanded":u,children:[e.jsx("span",{className:g?"":"placeholder",children:C}),e.jsx(re,{size:16,className:`select-chevron ${u?"open":""}`})]}),u&&e.jsxs("div",{className:"select-dropdown",role:"listbox",children:[e.jsx("input",{ref:P,type:"text",className:"select-search",placeholder:"Search...",value:k,onChange:o=>L(o.target.value),"aria-label":`Search ${N||"options"}`}),e.jsxs("div",{className:"select-options",children:[e.jsx("div",{role:"option","aria-selected":!g,className:`select-option ${g?"":"selected"}`,onClick:()=>{z(""),j(!1),L("")},children:B}),w.map(o=>e.jsx("div",{role:"option","aria-selected":g===o,className:`select-option ${g===o?"selected":""}`,onClick:()=>{z(o),j(!1),L("")},children:o},o)),w.length===0&&e.jsx("div",{className:"select-no-results",children:"No matches"})]})]})]})]})}const te=50,O=["#0a84ff","#30d158","#ff9f0a","#ff453a","#bf5af2","#64d2ff","#ff375f","#ffd60a","#ac8e68","#8e8e93"],G={background:"rgba(28, 28, 30, 0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"10px",boxShadow:"0 8px 32px rgba(0,0,0,0.4)",padding:"12px 16px"},Ue={spend:"Spend",contracts:"Contracts",purchase_cards:"Purchase Cards"},Q=N=>Ue[N]||N,Ye=["financial_year","quarter","month","type","service_division","expenditure_category","capital_revenue","supplier","min_amount","max_amount"];function ne({field:N,sortField:g,sortDir:R}){return g!==N?e.jsx(re,{size:14,className:"sort-inactive"}):R==="asc"?e.jsx(ke,{size:14}):e.jsx(re,{size:14})}function We(){const N=ve(),g=N.council_name||"Council",R=N.council_id||"council",{data:z,loading:B}=ge("/data/spending.json"),[u,j]=fe(),[k,L]=d.useState("table"),[T,P]=d.useState(!0),w=u.get("q")||"",C=u.get("sort")||"date",M=u.get("dir")||"desc",o=parseInt(u.get("page")||"1",10),l=d.useMemo(()=>{const a={};return Ye.forEach(s=>{a[s]=u.get(s)||""}),a},[u]),F=d.useCallback((a,s)=>{j(n=>{const i=new URLSearchParams(n);return s?i.set(a,s):i.delete(a),a!=="page"&&i.delete("page"),i},{replace:!0})},[j]),le=d.useCallback(a=>F("q",a),[F]),K=d.useCallback(a=>F("page",a>1?String(a):""),[F]),S=d.useCallback((a,s)=>F(a,s),[F]),W=d.useCallback(a=>{j(s=>{const n=new URLSearchParams(s);return n.get("sort")===a?n.set("dir",n.get("dir")==="asc"?"desc":"asc"):(n.set("sort",a),n.set("dir","desc")),n.delete("page"),n},{replace:!0})},[j]),pe=d.useCallback(()=>{j({},{replace:!0})},[j]);d.useEffect(()=>(document.title=`Spending Explorer | ${g} Council Transparency`,()=>{document.title=`${g} Council Transparency | Where Your Money Goes`}),[g]);const X=Object.values(l).filter(Boolean).length+(w?1:0),y=d.useMemo(()=>z||[],[z]),$=d.useMemo(()=>{if(!y.length)return{};const a=n=>[...new Set(n.filter(Boolean))].sort(),s=y.map(n=>n.date?new Date(n.date).toLocaleString("en-GB",{month:"long",year:"numeric"}):null);return{financial_years:a(y.map(n=>n.financial_year)),quarters:["Q1","Q2","Q3","Q4"],months:a(s),types:a(y.map(n=>n.type)),service_divisions:a(y.map(n=>n.service_division)),expenditure_categories:a(y.map(n=>n.expenditure_category)),capital_revenue:a(y.map(n=>n.capital_revenue)),suppliers:a(y.map(n=>n.supplier))}},[y]),h=d.useMemo(()=>{let a=y;if(w){const s=w.toLowerCase();a=a.filter(n=>n.supplier?.toLowerCase().includes(s)||n.organisational_unit?.toLowerCase().includes(s)||n.service_division?.toLowerCase().includes(s)||n.expenditure_category?.toLowerCase().includes(s)||n.transaction_number?.toLowerCase().includes(s))}if(l.financial_year&&(a=a.filter(s=>s.financial_year===l.financial_year)),l.quarter){const s=parseInt(l.quarter.replace("Q",""));a=a.filter(n=>n.quarter===s)}return l.month&&(a=a.filter(s=>s.date?new Date(s.date).toLocaleString("en-GB",{month:"long",year:"numeric"})===l.month:!1)),l.type&&(a=a.filter(s=>s.type===l.type)),l.service_division&&(a=a.filter(s=>s.service_division===l.service_division)),l.expenditure_category&&(a=a.filter(s=>s.expenditure_category===l.expenditure_category)),l.capital_revenue&&(a=a.filter(s=>s.capital_revenue===l.capital_revenue)),l.supplier&&(a=a.filter(s=>s.supplier===l.supplier)),l.min_amount&&(a=a.filter(s=>(s.amount||0)>=parseFloat(l.min_amount))),l.max_amount&&(a=a.filter(s=>(s.amount||0)<=parseFloat(l.max_amount))),a=[...a].sort((s,n)=>{let i=s[C],f=n[C];return C==="amount"?(i=Number(i)||0,f=Number(f)||0):C==="date"&&(i=new Date(i||"1970-01-01").getTime(),f=new Date(f||"1970-01-01").getTime()),i<f?M==="asc"?-1:1:i>f?M==="asc"?1:-1:0}),a},[y,w,l,C,M]),he=d.useMemo(()=>{const a=(o-1)*te;return h.slice(a,a+te)},[h,o]),U=Math.ceil(h.length/te),_=d.useMemo(()=>{const a=h.reduce((c,m)=>c+(Number(m.amount)||0),0),s=new Set(h.map(c=>c.supplier)).size,n=h.length>0?a/h.length:0,i=(()=>{if(!h.length)return 0;const c=h.map(Y=>Number(Y.amount)||0).sort((Y,q)=>Y-q),m=Math.floor(c.length/2);return c.length%2?c[m]:(c[m-1]+c[m])/2})(),f=h.reduce((c,m)=>Math.max(c,Number(m.amount)||0),0),D={};return h.forEach(c=>{const m=c.type||"other";D[m]=(D[m]||0)+(Number(c.amount)||0)}),{total:a,count:h.length,suppliers:s,avgTransaction:n,medianAmount:i,maxTransaction:f,byType:D}},[h]),p=d.useMemo(()=>{const a=t=>{const r={};return h.forEach(v=>{const b=t(v);b&&(r[b]=(r[b]||0)+(v.amount||0))}),r},s=t=>{const r={};return h.forEach(v=>{const b=t(v);b&&(r[b]=(r[b]||0)+1)}),r},n=a(t=>t.financial_year||"Unknown"),i=s(t=>t.financial_year||"Unknown"),f=a(t=>t.expenditure_category||"Other"),D=a(t=>t.service_division||"Other"),c=a(t=>t.supplier||"Unknown"),m=s(t=>t.supplier||"Unknown"),Y=a(t=>t.type||"other"),q={},J={};h.forEach(t=>{if(!t.date)return;const r=new Date(t.date),v=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;q[v]=(q[v]||0)+(t.amount||0),J[v]=(J[v]||0)+1});const me=Object.entries(q).map(([t,r])=>({month:t,amount:r,count:J[t]||0,label:(()=>{const[v,b]=t.split("-");return new Date(v,b-1).toLocaleString("en-GB",{month:"short",year:"2-digit"})})()})).sort((t,r)=>t.month.localeCompare(r.month)).slice(-36).map((t,r,v)=>{const b=v.slice(Math.max(0,r-2),r+1);return{...t,avg:b.reduce((xe,je)=>xe+je.amount,0)/b.length}});return{yearData:Object.entries(n).map(([t,r])=>({year:t,amount:r,count:i[t]||0,avg:(i[t]||1)>0?r/i[t]:0})).sort((t,r)=>t.year.localeCompare(r.year)),categoryData:Object.entries(f).map(([t,r])=>({name:t,value:r})).sort((t,r)=>r.value-t.value).slice(0,10),serviceData:Object.entries(D).map(([t,r])=>({name:t.split(" - ")[1]||t,fullName:t,value:r})).sort((t,r)=>r.value-t.value).slice(0,10),supplierData:Object.entries(c).map(([t,r])=>({name:E(t,25),fullName:t,value:r,count:m[t]||0})).sort((t,r)=>r.value-t.value).slice(0,10),typeData:Object.entries(Y).map(([t,r])=>({name:Q(t),value:r,rawType:t})).sort((t,r)=>r.value-t.value),monthlyData:me}},[h]),ue=()=>{const a=["Date","Supplier","Amount","Type","Service","Category","Org Unit","Transaction"],s=h.map(c=>[c.date,c.supplier,c.amount,c.type,c.service_division,c.expenditure_category,c.organisational_unit,c.transaction_number]),n=[a,...s].map(c=>c.map(m=>`"${m||""}"`).join(",")).join(`
`),i=new Blob([n],{type:"text/csv"}),f=URL.createObjectURL(i),D=document.createElement("a");D.href=f,D.download=`${R}-spending-export-${new Date().toISOString().split("T")[0]}.csv`,D.click(),URL.revokeObjectURL(f)};return B?e.jsx(ye,{message:"Loading spending data..."}):e.jsxs("div",{className:"spending-page animate-fade-in",children:[e.jsxs("header",{className:"page-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{children:"Spending Explorer"}),e.jsxs("p",{className:"subtitle",children:["Search and analyse ",y.length.toLocaleString()," council transactions"]}),e.jsx(be,{source:"Spending data",compact:!0})]}),e.jsx("div",{className:"header-actions",children:e.jsxs("button",{className:"export-btn",onClick:ue,children:[e.jsx(Pe,{size:18}),"Export CSV"]})})]}),e.jsxs("div",{className:"search-section",children:[e.jsxs("div",{className:"search-bar",children:[e.jsx(Ne,{size:20,className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search suppliers, services, transaction numbers...",value:w,onChange:a=>le(a.target.value),"aria-label":"Search spending records"}),w&&e.jsx("button",{className:"search-clear",onClick:()=>le(""),"aria-label":"Clear search",children:e.jsx(ie,{size:16})})]}),e.jsxs("button",{className:`filter-toggle ${T?"active":""}`,onClick:()=>P(!T),"aria-expanded":T,children:[e.jsx(we,{size:18}),"Filters",X>0&&e.jsx("span",{className:"filter-count",children:X})]})]}),T&&e.jsxs("div",{className:"filter-panel",children:[e.jsxs("div",{className:"filter-grid",children:[e.jsx(A,{label:"Financial Year",value:l.financial_year,options:$.financial_years||[],onChange:a=>S("financial_year",a),placeholder:"All Years"}),e.jsx(A,{label:"Quarter",value:l.quarter,options:$.quarters||[],onChange:a=>S("quarter",a),placeholder:"All Quarters"}),e.jsx(A,{label:"Month",value:l.month,options:$.months||[],onChange:a=>S("month",a),placeholder:"All Months"}),e.jsx(A,{label:"Data Type",value:l.type,options:$.types||[],onChange:a=>S("type",a),placeholder:"All Types"}),e.jsx(A,{label:"Service Division",value:l.service_division,options:$.service_divisions||[],onChange:a=>S("service_division",a),placeholder:"All Services"}),e.jsx(A,{label:"Expenditure Category",value:l.expenditure_category,options:$.expenditure_categories||[],onChange:a=>S("expenditure_category",a),placeholder:"All Categories"}),e.jsx(A,{label:"Capital/Revenue",value:l.capital_revenue,options:$.capital_revenue||[],onChange:a=>S("capital_revenue",a),placeholder:"All"}),e.jsx(A,{label:"Supplier",value:l.supplier,options:$.suppliers||[],onChange:a=>S("supplier",a),placeholder:"All Suppliers"}),e.jsxs("div",{className:"filter-group amount-filter",children:[e.jsx("label",{children:"Amount Range"}),e.jsxs("div",{className:"amount-inputs",children:[e.jsx("input",{type:"number",placeholder:"Min £",value:l.min_amount,onChange:a=>S("min_amount",a.target.value),"aria-label":"Minimum amount"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"number",placeholder:"Max £",value:l.max_amount,onChange:a=>S("max_amount",a.target.value),"aria-label":"Maximum amount"})]})]})]}),X>0&&e.jsxs("button",{className:"clear-filters",onClick:pe,children:[e.jsx(ie,{size:16}),"Clear all filters"]})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card stat-primary",children:[e.jsx("div",{className:"stat-card-icon",children:e.jsx(Ae,{size:20})}),e.jsxs("div",{className:"stat-card-body",children:[e.jsx("span",{className:"stat-card-value",children:x(_.total,!0)}),e.jsx("span",{className:"stat-card-label",children:"Total Spend"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-card-icon",children:e.jsx(De,{size:20})}),e.jsxs("div",{className:"stat-card-body",children:[e.jsx("span",{className:"stat-card-value",children:_.count.toLocaleString()}),e.jsx("span",{className:"stat-card-label",children:"Transactions"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-card-icon",children:e.jsx(Ce,{size:20})}),e.jsxs("div",{className:"stat-card-body",children:[e.jsx("span",{className:"stat-card-value",children:_.suppliers.toLocaleString()}),e.jsx("span",{className:"stat-card-label",children:"Suppliers"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-card-icon",children:e.jsx(Se,{size:20})}),e.jsxs("div",{className:"stat-card-body",children:[e.jsx("span",{className:"stat-card-value",children:x(_.avgTransaction,!0)}),e.jsx("span",{className:"stat-card-label",children:"Average"}),e.jsxs("span",{className:"stat-card-sub",children:["Median: ",x(_.medianAmount,!0)]})]})]}),Object.keys(_.byType).length>0&&e.jsxs("div",{className:"stat-card stat-wide type-breakdown-card",children:[e.jsx("div",{className:"type-breakdown-bar",children:Object.entries(_.byType).sort((a,s)=>s[1]-a[1]).map(([a,s])=>e.jsx("div",{className:`type-segment ${a}`,style:{flex:s},title:`${Q(a)}: ${x(s,!0)}`},a))}),e.jsx("div",{className:"type-breakdown-legend",children:Object.entries(_.byType).sort((a,s)=>s[1]-a[1]).map(([a,s])=>e.jsxs("span",{className:"type-legend-item",children:[e.jsx("span",{className:`type-dot ${a}`}),Q(a),": ",x(s,!0),e.jsxs("span",{className:"type-pct",children:["(",_.total>0?(s/_.total*100).toFixed(1):0,"%)"]})]},a))})]})]}),e.jsxs("div",{className:"tab-nav",role:"tablist",children:[e.jsx("button",{role:"tab","aria-selected":k==="table",className:`tab-btn ${k==="table"?"active":""}`,onClick:()=>L("table"),children:"Data Table"}),e.jsx("button",{role:"tab","aria-selected":k==="charts",className:`tab-btn ${k==="charts"?"active":""}`,onClick:()=>L("charts"),children:"Visualisations"})]}),k==="table"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"spending-table",role:"table","aria-label":"Spending records",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{scope:"col",className:"sortable",onClick:()=>W("date"),"aria-label":"Sort by date",children:["Date ",e.jsx(ne,{field:"date",sortField:C,sortDir:M})]}),e.jsxs("th",{scope:"col",className:"sortable",onClick:()=>W("supplier"),"aria-label":"Sort by supplier",children:["Supplier ",e.jsx(ne,{field:"supplier",sortField:C,sortDir:M})]}),e.jsx("th",{scope:"col",children:"Service"}),e.jsx("th",{scope:"col",children:"Category"}),e.jsxs("th",{scope:"col",className:"sortable amount-col",onClick:()=>W("amount"),"aria-label":"Sort by amount",children:["Amount ",e.jsx(ne,{field:"amount",sortField:C,sortDir:M})]}),e.jsx("th",{scope:"col",children:"Type"})]})}),e.jsx("tbody",{children:he.map((a,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"date-col",children:_e(a.date)}),e.jsxs("td",{className:"supplier-col",children:[e.jsx("span",{className:"supplier-name",children:E(a.supplier,35)}),a.is_covid_related&&e.jsx("span",{className:"covid-badge",children:"COVID"})]}),e.jsx("td",{className:"service-col text-secondary",children:E(a.service_division?.split(" - ")[1]||a.service_division,20)}),e.jsx("td",{className:"category-col text-secondary",children:E(a.expenditure_category,25)}),e.jsx("td",{className:"amount-col",children:x(a.amount)}),e.jsx("td",{className:"type-col",children:e.jsx("span",{className:`type-badge ${a.type}`,children:Q(a.type)})})]},`${a.transaction_number}-${s}`))})]})}),U>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"page-btn",disabled:o===1,onClick:()=>K(1),children:"First"}),e.jsx("button",{className:"page-btn",disabled:o===1,onClick:()=>K(o-1),children:"Previous"}),e.jsxs("span",{className:"page-info",children:["Page ",o," of ",U]}),e.jsx("button",{className:"page-btn",disabled:o===U,onClick:()=>K(o+1),children:"Next"}),e.jsx("button",{className:"page-btn",disabled:o===U,onClick:()=>K(U),children:"Last"})]})]}),k==="charts"&&e.jsxs("div",{className:"charts-grid",children:[e.jsxs("div",{className:"chart-card wide hero-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Monthly Spending Trend"}),e.jsxs("p",{className:"chart-subtitle",children:["Last ",p.monthlyData.length," months with 3-month rolling average"]})]}),p.monthlyData.length>=2&&(()=>{const a=p.monthlyData[p.monthlyData.length-1]?.amount||0,s=p.monthlyData[p.monthlyData.length-2]?.amount||0,n=s>0?(a-s)/s*100:0,i=n>=0;return e.jsxs("div",{className:`chart-trend ${i?"up":"down"}`,children:[i?e.jsx(Re,{size:16}):e.jsx(Ee,{size:16}),e.jsxs("span",{children:[Math.abs(n).toFixed(1),"%"]}),e.jsx("span",{className:"chart-trend-label",children:"vs prior month"})]})})()]}),e.jsx(I,{width:"100%",height:320,children:e.jsxs(Le,{data:p.monthlyData,margin:{top:10,right:30,left:20,bottom:5},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"spendGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#0a84ff",stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:"#0a84ff",stopOpacity:0})]})}),e.jsx(Z,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.04)"}),e.jsx(ee,{dataKey:"label",tick:{fill:"var(--text-tertiary)",fontSize:11},interval:2,axisLine:!1,tickLine:!1}),e.jsx(ae,{tick:{fill:"var(--text-tertiary)",fontSize:11},tickFormatter:a=>`£${(a/1e6).toFixed(1)}M`,axisLine:!1,tickLine:!1}),e.jsx(V,{contentStyle:G,formatter:(a,s)=>[x(a,!0),s==="avg"?"3-Mo Average":"Monthly Spend"],labelFormatter:a=>a}),e.jsx(ce,{type:"monotone",dataKey:"amount",stroke:"#0a84ff",strokeWidth:2,fill:"url(#spendGradient)"}),e.jsx(ce,{type:"monotone",dataKey:"avg",stroke:"#ff9f0a",strokeWidth:2,strokeDasharray:"6 3",fill:"none"})]})})]}),e.jsxs("div",{className:"chart-card",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{children:"Spend by Financial Year"})}),e.jsx(I,{width:"100%",height:300,children:e.jsxs(oe,{data:p.yearData,margin:{top:20,right:30,left:10,bottom:5},children:[e.jsx(Z,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.04)"}),e.jsx(ee,{dataKey:"year",tick:{fill:"var(--text-tertiary)",fontSize:11},axisLine:!1,tickLine:!1}),e.jsx(ae,{tick:{fill:"var(--text-tertiary)",fontSize:11},tickFormatter:a=>`£${(a/1e6).toFixed(0)}M`,axisLine:!1,tickLine:!1}),e.jsx(V,{contentStyle:G,formatter:a=>[x(a,!0),"Total"],labelFormatter:a=>`FY ${a}`}),e.jsx(de,{dataKey:"amount",radius:[6,6,0,0],children:p.yearData.map((a,s)=>e.jsx(se,{fill:s===p.yearData.length-1?"#0a84ff":"rgba(10, 132, 255, 0.35)"},s))})]})}),e.jsx("div",{className:"chart-year-footer",children:p.yearData.slice(-3).map(a=>e.jsxs("div",{className:"year-stat",children:[e.jsx("span",{className:"year-stat-label",children:a.year}),e.jsx("span",{className:"year-stat-value",children:x(a.amount,!0)}),e.jsxs("span",{className:"year-stat-sub",children:[a.count.toLocaleString()," txns"]})]},a.year))})]}),e.jsxs("div",{className:"chart-card",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{children:"Spending by Type"})}),e.jsx(I,{width:"100%",height:280,children:e.jsxs(Te,{children:[e.jsx(Me,{data:p.typeData,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:3,strokeWidth:0,children:p.typeData.map(a=>e.jsx(se,{fill:a.rawType==="spend"?"#0a84ff":a.rawType==="contracts"?"#bf5af2":"#30d158"},a.rawType))}),e.jsx(V,{contentStyle:G,formatter:a=>[x(a,!0),"Total"]})]})}),e.jsx("div",{className:"donut-legend",children:p.typeData.map(a=>e.jsxs("div",{className:"donut-legend-item",children:[e.jsx("span",{className:`type-dot ${a.rawType}`}),e.jsx("span",{className:"donut-legend-name",children:a.name}),e.jsx("span",{className:"donut-legend-value",children:x(a.value,!0)})]},a.rawType))})]}),e.jsxs("div",{className:"chart-card wide",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{children:"Top 10 Suppliers by Value"}),e.jsx("p",{className:"chart-subtitle",children:"Hover for transaction count"})]}),e.jsx(I,{width:"100%",height:380,children:e.jsxs(oe,{data:p.supplierData,layout:"vertical",margin:{top:10,right:40,left:130,bottom:5},children:[e.jsx(Z,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.04)",horizontal:!1}),e.jsx(ee,{type:"number",tick:{fill:"var(--text-tertiary)",fontSize:11},tickFormatter:a=>`£${(a/1e6).toFixed(1)}M`,axisLine:!1,tickLine:!1}),e.jsx(ae,{type:"category",dataKey:"name",tick:{fill:"var(--text-secondary)",fontSize:11},width:120,axisLine:!1,tickLine:!1}),e.jsx(V,{contentStyle:G,formatter:(a,s,n)=>{const i=n.payload;return[`${x(a,!0)} (${i.count} transactions)`,i.fullName]}}),e.jsx(de,{dataKey:"value",radius:[0,6,6,0],children:p.supplierData.map((a,s)=>e.jsx(se,{fill:O[s%O.length],fillOpacity:.85},s))})]})})]}),e.jsxs("div",{className:"chart-card",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{children:"Top Expenditure Categories"})}),e.jsx("div",{className:"inline-bar-list",children:p.categoryData.slice(0,8).map((a,s)=>{const n=p.categoryData[0]?.value||1,i=a.value/n*100;return e.jsxs("div",{className:"inline-bar-item",children:[e.jsx("span",{className:"inline-bar-label",title:a.name,children:E(a.name,22)}),e.jsx("div",{className:"inline-bar-track",children:e.jsx("div",{className:"inline-bar-fill",style:{width:`${i}%`,background:O[s%O.length]}})}),e.jsx("span",{className:"inline-bar-value",children:x(a.value,!0)})]},a.name)})})]}),e.jsxs("div",{className:"chart-card",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{children:"Spending by Service Division"})}),e.jsx("div",{className:"inline-bar-list",children:p.serviceData.slice(0,8).map((a,s)=>{const n=p.serviceData[0]?.value||1,i=a.value/n*100;return e.jsxs("div",{className:"inline-bar-item",children:[e.jsx("span",{className:"inline-bar-label",title:a.fullName,children:E(a.name,22)}),e.jsx("div",{className:"inline-bar-track",children:e.jsx("div",{className:"inline-bar-fill",style:{width:`${i}%`,background:O[(s+2)%O.length]}})}),e.jsx("span",{className:"inline-bar-value",children:x(a.value,!0)})]},a.name)})})]})]})]})}export{We as default};
