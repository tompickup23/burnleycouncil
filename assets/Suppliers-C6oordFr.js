import{j as s}from"./tanstack-BHj98Y4o.js";import{r,L as H}from"./vendor-BUcjPAt-.js";import{c as E,u as P,a as B,L as I,j as p,B as U,S as R,g as K,h as O,d as q,b as G}from"./index-pGaQqd3_.js";import"./recharts-DyzHFDWD.js";const W=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],J=E("arrow-up-down",W);const Q=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],X=E("chevron-left",Q),L=50,F=["clean","low","medium","high","critical"],$={clean:"Clean",low:"Low",medium:"Medium",high:"High",critical:"Critical"},Y={name:{label:"Name",getter:a=>(a.name||"").toLowerCase()},total_spend:{label:"Total Spend",getter:a=>a.spending?.total_all_councils||0},transactions:{label:"Transactions",getter:a=>a.spending?.transaction_count||0},councils:{label:"Councils",getter:a=>a.spending?.councils_count||0},ch_status:{label:"CH Status",getter:a=>a.companies_house?1:0},risk_level:{label:"Risk Level",getter:a=>F.indexOf(a.compliance?.risk_level||"clean")},violations:{label:"Violations",getter:a=>a.compliance?.violation_count||0}};function j({field:a,label:t,sortField:k,sortDir:_,onSort:i}){const o=k===a;return s.jsxs("th",{className:"sortable",onClick:()=>i(a),scope:"col","aria-sort":o?_==="asc"?"ascending":"descending":"none","aria-label":`Sort by ${t}`,role:"columnheader",children:[s.jsxs("span",{className:"sort-header-content",children:[t,s.jsx(J,{size:14,className:`sort-icon ${o?"sort-active":"sort-inactive"}`,"aria-hidden":"true"})]}),o&&s.jsx("span",{className:"sort-direction",children:_==="asc"?"▲":"▼"})]})}function Z({level:a}){return a?s.jsx("span",{className:`risk-badge ${a}`,children:$[a]||a}):s.jsx("span",{className:"risk-badge clean",children:"Clean"})}function ss({companiesHouse:a}){if(a){const t=a.status||"unknown";return s.jsx("span",{className:`ch-badge matched ${t==="active"?"active":t==="dissolved"?"dissolved":""}`,children:t==="active"?"Active":t==="dissolved"?"Dissolved":t.charAt(0).toUpperCase()+t.slice(1)})}return s.jsx("span",{className:"ch-badge unmatched",children:"Unmatched"})}function is(){const t=P().council_name||"Council",{data:k,loading:_}=B("/data/supplier_profiles.json"),i=k?.profiles||[],[o,y]=r.useState(""),[b,D]=r.useState(""),[N,T]=r.useState(""),[n,A]=r.useState("total_spend"),[c,w]=r.useState("desc"),[u,v]=r.useState(1);r.useEffect(()=>(document.title=`Supplier Directory | ${t} Council Transparency`,()=>{document.title=`${t} Council Transparency`}),[t]),r.useEffect(()=>{v(1)},[o,b,N,n,c]);const m=e=>{n===e?w(x=>x==="asc"?"desc":"asc"):(A(e),w("desc"))},S=r.useMemo(()=>{const e=i.length,x=i.filter(d=>d.companies_house).length,l=i.filter(d=>(d.compliance?.violation_count||0)>0).length,h=i.filter(d=>d.compliance?.risk_level==="critical").length;return{total:e,chMatched:x,withViolations:l,criticalRisk:h}},[i]),g=r.useMemo(()=>{let e=i;if(o){const l=o.toLowerCase().trim();e=e.filter(h=>{const d=h.name?.toLowerCase().includes(l),C=h.canonical?.toLowerCase().includes(l),V=h.companies_house?.company_number?.toLowerCase().includes(l),z=h.companies_house?.legal_name?.toLowerCase().includes(l);return d||C||V||z})}b&&(e=e.filter(l=>(l.compliance?.risk_level||"clean")===b)),N==="matched"?e=e.filter(l=>l.companies_house):N==="unmatched"&&(e=e.filter(l=>!l.companies_house));const x=Y[n];return x&&(e=[...e].sort((l,h)=>{const d=x.getter(l),C=x.getter(h);return d<C?c==="asc"?-1:1:d>C?c==="asc"?1:-1:0})),e},[i,o,b,N,n,c]),f=Math.ceil(g.length/L),M=r.useMemo(()=>{const e=(u-1)*L;return g.slice(e,e+L)},[g,u]);return _?s.jsx(I,{message:"Loading supplier profiles..."}):s.jsxs("div",{className:"suppliers-page animate-fade-in",children:[s.jsx("header",{className:"suppliers-header",children:s.jsxs("div",{className:"header-content",children:[s.jsx("h1",{children:"Supplier Directory"}),s.jsxs("p",{className:"suppliers-subtitle",children:[p(i.length)," suppliers across all council spending data"]})]})}),s.jsxs("div",{className:"suppliers-stats-grid",children:[s.jsxs("div",{className:"suppliers-stat-card",children:[s.jsx("div",{className:"suppliers-stat-icon",children:s.jsx(U,{size:20})}),s.jsxs("div",{className:"suppliers-stat-body",children:[s.jsx("span",{className:"suppliers-stat-value",children:p(S.total)}),s.jsx("span",{className:"suppliers-stat-label",children:"Total Suppliers"})]})]}),s.jsxs("div",{className:"suppliers-stat-card",children:[s.jsx("div",{className:"suppliers-stat-icon stat-icon-blue",children:s.jsx(R,{size:20})}),s.jsxs("div",{className:"suppliers-stat-body",children:[s.jsx("span",{className:"suppliers-stat-value",children:p(S.chMatched)}),s.jsx("span",{className:"suppliers-stat-label",children:"CH Matched"})]})]}),s.jsxs("div",{className:"suppliers-stat-card",children:[s.jsx("div",{className:"suppliers-stat-icon stat-icon-orange",children:s.jsx(K,{size:20})}),s.jsxs("div",{className:"suppliers-stat-body",children:[s.jsx("span",{className:"suppliers-stat-value",children:p(S.withViolations)}),s.jsx("span",{className:"suppliers-stat-label",children:"With Violations"})]})]}),s.jsxs("div",{className:"suppliers-stat-card",children:[s.jsx("div",{className:"suppliers-stat-icon stat-icon-red",children:s.jsx(O,{size:20})}),s.jsxs("div",{className:"suppliers-stat-body",children:[s.jsx("span",{className:"suppliers-stat-value",children:p(S.criticalRisk)}),s.jsx("span",{className:"suppliers-stat-label",children:"Critical Risk"})]})]})]}),s.jsxs("div",{className:"suppliers-controls",children:[s.jsxs("div",{className:"suppliers-search-bar",children:[s.jsx(R,{size:20,className:"suppliers-search-icon"}),s.jsx("input",{type:"text",placeholder:"Search by name or company number...",value:o,onChange:e=>y(e.target.value),"aria-label":"Search suppliers"}),o&&s.jsx("button",{className:"suppliers-search-clear",onClick:()=>y(""),"aria-label":"Clear search",children:"×"})]}),s.jsxs("div",{className:"suppliers-filter-row",children:[s.jsxs("div",{className:"suppliers-filter-group",children:[s.jsx("label",{htmlFor:"risk-filter",children:"Risk Level"}),s.jsxs("select",{id:"risk-filter",value:b,onChange:e=>D(e.target.value),children:[s.jsx("option",{value:"",children:"All"}),F.map(e=>s.jsx("option",{value:e,children:$[e]},e))]})]}),s.jsxs("div",{className:"suppliers-filter-group",children:[s.jsx("label",{htmlFor:"ch-filter",children:"CH Status"}),s.jsxs("select",{id:"ch-filter",value:N,onChange:e=>T(e.target.value),children:[s.jsx("option",{value:"",children:"All"}),s.jsx("option",{value:"matched",children:"Matched"}),s.jsx("option",{value:"unmatched",children:"Unmatched"})]})]}),s.jsx("div",{className:"suppliers-filter-results",children:g.length===i.length?`${p(g.length)} suppliers`:`${p(g.length)} of ${p(i.length)} suppliers`})]})]}),s.jsx("div",{className:"suppliers-table-container",children:s.jsxs("table",{className:"suppliers-table",role:"table","aria-label":"Supplier directory",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx(j,{field:"name",label:"Name",sortField:n,sortDir:c,onSort:m}),s.jsx(j,{field:"total_spend",label:"Total Spend",sortField:n,sortDir:c,onSort:m}),s.jsx(j,{field:"transactions",label:"Transactions",sortField:n,sortDir:c,onSort:m}),s.jsx(j,{field:"councils",label:"Councils",sortField:n,sortDir:c,onSort:m}),s.jsx(j,{field:"ch_status",label:"CH Status",sortField:n,sortDir:c,onSort:m}),s.jsx(j,{field:"risk_level",label:"Risk Level",sortField:n,sortDir:c,onSort:m}),s.jsx(j,{field:"violations",label:"Violations",sortField:n,sortDir:c,onSort:m})]})}),s.jsx("tbody",{children:M.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"suppliers-empty",children:"No suppliers match your search criteria."})}):M.map(e=>s.jsxs("tr",{children:[s.jsxs("td",{className:"supplier-name-cell",children:[s.jsx(H,{to:`/supplier/${e.id}`,className:"supplier-link",children:e.name}),e.companies_house?.legal_name&&e.companies_house.legal_name!==e.name&&s.jsx("span",{className:"supplier-legal-name",children:e.companies_house.legal_name})]}),s.jsx("td",{className:"amount-cell",children:q(e.spending?.total_all_councils,!0)}),s.jsx("td",{className:"number-cell",children:p(e.spending?.transaction_count)}),s.jsx("td",{className:"number-cell",children:p(e.spending?.councils_count)}),s.jsx("td",{children:s.jsx(ss,{companiesHouse:e.companies_house})}),s.jsx("td",{children:s.jsx(Z,{level:e.compliance?.risk_level})}),s.jsx("td",{className:"number-cell",children:e.compliance?.violation_count||0})]},e.id))})]})}),f>1&&s.jsxs("div",{className:"suppliers-pagination",children:[s.jsx("button",{className:"suppliers-page-btn",disabled:u===1,onClick:()=>v(1),"aria-label":"First page",children:"First"}),s.jsxs("button",{className:"suppliers-page-btn",disabled:u===1,onClick:()=>v(u-1),"aria-label":"Previous page",children:[s.jsx(X,{size:16}),"Previous"]}),s.jsxs("span",{className:"suppliers-page-info",children:["Page ",u," of ",f]}),s.jsxs("button",{className:"suppliers-page-btn",disabled:u===f,onClick:()=>v(u+1),"aria-label":"Next page",children:["Next",s.jsx(G,{size:16})]}),s.jsx("button",{className:"suppliers-page-btn",disabled:u===f,onClick:()=>v(f),"aria-label":"Last page",children:"Last"})]})]})}export{is as default};
