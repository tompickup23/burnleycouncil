import{j as e}from"./tanstack-BHj98Y4o.js";import{r}from"./vendor-BUcjPAt-.js";import{c as w,u as M,a as F,L as D,S as E,M as A}from"./index-g-N5icRo.js";import{C as k}from"./circle-alert-kCifC3Af.js";import{M as T}from"./mail-B-7S1XAh.js";import{P as I}from"./phone-Wtj9E7P-.js";import"./recharts-DyzHFDWD.js";const R=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],U=w("circle-check",R);const W=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],O=w("loader-circle",W);const Y=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],B=w("user",Y);function X(){const i=M(),c=i.council_name||"Council",{data:_,loading:L}=F(["/data/wards.json","/data/councillors.json"]),[h,P]=_||[{},[]],[n,u]=r.useState(null),[x,$]=r.useState(""),[y,N]=r.useState(!1),[j,t]=r.useState(null),[o,d]=r.useState(null),S=r.useCallback(async s=>{const a=s.replace(/\s+/g,"").toUpperCase();if(a.length<5){t("Please enter a valid postcode");return}N(!0),t(null),d(null);try{const m=await(await fetch(`https://api.postcodes.io/postcodes/${encodeURIComponent(a)}`)).json();if(m.status!==200||!m.result){t("Postcode not found. Please check and try again.");return}const{admin_ward:b,admin_district:p}=m.result;if(d({ward:b,district:p,postcode:m.result.postcode}),p&&p.toLowerCase()!==c.toLowerCase()){t(`That postcode is in ${p}, not ${c}. Try a local postcode.`);return}const C=Object.values(h).find(f=>f.name.toLowerCase()===b?.toLowerCase());C?(u(C.name),setTimeout(()=>{document.querySelector(".ward-details")?.scrollIntoView({behavior:"smooth",block:"start"})},100)):d(f=>({...f,noData:!0}))}catch{t("Unable to look up postcode. Please try again.")}finally{N(!1)}},[h,c]),z=s=>{s.preventDefault(),S(x)};if(r.useEffect(()=>(document.title=`My Area | ${c} Council Transparency`,()=>{document.title=`${c} Council Transparency`}),[c]),L)return e.jsx(D,{message:"Loading ward data..."});const g=Object.values(h).sort((s,a)=>s.name.localeCompare(a.name)),v=s=>P.filter(a=>a.ward===s);return e.jsxs("div",{className:"myarea-page animate-fade-in",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"My Area"}),e.jsxs("p",{className:"subtitle",children:["Find your ward and councillors in ",c,". Enter your postcode or select a ward below."]})]}),e.jsxs("section",{className:"postcode-lookup",children:[e.jsxs("form",{onSubmit:z,className:"postcode-form",children:[e.jsx("label",{htmlFor:"postcode-input",children:"Find your ward by postcode"}),e.jsxs("div",{className:"postcode-input-row",children:[e.jsxs("div",{className:"postcode-input-wrapper",children:[e.jsx(E,{size:18,className:"postcode-search-icon"}),e.jsx("input",{id:"postcode-input",type:"text",placeholder:"e.g. BB11 3DF",value:x,onChange:s=>{$(s.target.value),t(null),d(null)},maxLength:10,autoComplete:"postal-code"})]}),e.jsx("button",{type:"submit",className:"postcode-btn",disabled:y||!x.trim(),children:y?e.jsx(O,{size:18,className:"spin"}):"Look up"})]})]}),j&&e.jsxs("div",{className:"postcode-message error",children:[e.jsx(k,{size:16}),e.jsx("span",{children:j})]}),o&&!j&&e.jsx("div",{className:`postcode-message ${o.noData?"info":"success"}`,children:o.noData?e.jsxs(e.Fragment,{children:[e.jsx(k,{size:16}),e.jsxs("span",{children:["Your ward is ",e.jsx("strong",{children:o.ward})," in ",o.district,", but we don't have detailed councillor data for it yet."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{size:16}),e.jsxs("span",{children:[e.jsx("strong",{children:o.postcode})," is in ",e.jsx("strong",{children:o.ward})," ward"]})]})})]}),e.jsxs("section",{className:"ward-selector",children:[e.jsx("label",{htmlFor:"ward-select",children:"Or select your ward:"}),e.jsxs("select",{id:"ward-select",value:n||"",onChange:s=>u(s.target.value||null),children:[e.jsx("option",{value:"",children:"Choose a ward..."}),g.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]})]}),n&&e.jsxs("section",{className:"ward-details animate-fade-in",children:[e.jsxs("div",{className:"ward-header",children:[e.jsx(A,{size:24,className:"ward-icon"}),e.jsxs("div",{children:[e.jsx("h2",{children:n}),e.jsx("p",{className:"text-secondary",children:"Your local councillors"})]})]}),e.jsx("div",{className:"ward-councillors",children:v(n).map(s=>e.jsxs("div",{className:"councillor-detail-card",children:[e.jsx("div",{className:"party-bar",style:{background:s.party_color}}),e.jsxs("div",{className:"councillor-content",children:[e.jsxs("div",{className:"councillor-main",children:[e.jsx(B,{size:40,className:"councillor-avatar"}),e.jsxs("div",{children:[e.jsx("h3",{children:s.name}),e.jsx("span",{className:"party-badge",style:{background:s.party_color+"25",color:s.party_color},children:s.party})]})]}),s.roles?.length>0&&e.jsx("div",{className:"councillor-roles",children:s.roles.map((a,l)=>e.jsx("span",{className:"role-badge",children:a},l))}),e.jsxs("div",{className:"councillor-contact",children:[s.email&&e.jsxs("a",{href:`mailto:${s.email}`,className:"contact-link",children:[e.jsx(T,{size:16}),e.jsx("span",{children:s.email})]}),s.phone&&e.jsxs("a",{href:`tel:${s.phone}`,className:"contact-link",children:[e.jsx(I,{size:16}),e.jsx("span",{children:s.phone})]})]})]})]},s.id))})]}),e.jsxs("section",{className:"all-wards",children:[e.jsx("h2",{children:"All Wards"}),e.jsx("div",{className:"wards-grid",children:g.map(s=>{const a=v(s.name);return e.jsxs("div",{className:`ward-card ${n===s.name?"selected":""}`,onClick:()=>u(s.name),children:[e.jsx("div",{className:"ward-party-indicator",style:{background:s.color}}),e.jsxs("div",{className:"ward-content",children:[e.jsx("h3",{children:s.name}),e.jsx("p",{className:"ward-parties text-secondary",children:s.parties?.join(", ")}),e.jsx("div",{className:"ward-councillor-names",children:a.map(l=>e.jsx("span",{className:"councillor-name",children:l.name},l.id))})]})]},s.name)})})]}),e.jsxs("section",{className:"find-ward",children:[e.jsx("h2",{children:"More Information"}),e.jsxs("div",{className:"find-ward-card",children:[e.jsxs("p",{children:["For full councillor details and meeting schedules, visit the official ",c," Council website."]}),e.jsxs("a",{href:i.find_councillor_url||`${i.official_website||"#"}/council-democracy/councillors-mps/find-your-councillor/`,target:"_blank",rel:"noopener noreferrer",className:"find-ward-link",children:["Find Your Councillor on ",(i.official_website||"").replace(/^https?:\/\/(www\.)?/,"").replace(/\/$/,"")," â†’"]})]})]})]})}export{X as default};
